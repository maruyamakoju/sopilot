# SOPilot 商用化プラン — RTX 5090 × アルゴリズム改善

**目標**: 「レジャータイム」→「金を取れるレベル」への引き上げ
**制約**: 業界特化（製造業SOP評価）
**リソース**: RTX 5090（32GB VRAM）
**成功指標**: R@1 ≥ 0.90、製造業顧客にデモ可能、評価コスト95%削減の実証

---

## 📊 現状分析：なぜ「金を取れない」のか？

### ボトルネック1: 精度不足（R@1=0.74）
- **現状**: Visual-only R@1=0.74、業界標準（0.90+）に届かず
- **原因**: ViT-B-32（512-dim）の判別力不足、re-rankingが軽量すぎる
- **影響**: 顧客は「74%しか正しく検索できない」と見る → 信頼性に疑問

### ボトルネック2: 汎用的すぎる（業界特化なし）
- **現状**: 色パターンの合成動画でベンチマーク、製造業特化機能なし
- **原因**: 工具認識、安全装備検出、産業用語彙がない
- **影響**: 製造業顧客に「うちの現場で使える」と思わせられない

### ボトルネック3: GPU未活用（RTX 5090が遊んでいる）
- **現状**: 32GB VRAMの大半が未使用、バッチ処理も小規模
- **原因**: モデルサイズが小さい（ViT-B-32）、並列化不足
- **影響**: 処理速度で差別化できない（「2時間→5分」が「2時間→30秒」にできるはず）

### ボトルネック4: Neural mode未活用
- **現状**: Heuristicモードで動作、訓練済みの高精度モデルが眠っている
- **原因**: デフォルト設定がneural_mode=False
- **影響**: ProjectionHead/ScoringHead/Conformalの精度向上効果が出ていない

---

## 🚀 8つの改善タスク（優先度順）

### Phase 1: 即効性（2-3日）— 既存資産の活性化

#### Task #28: Neural scoringの精度向上 ✅ **最優先**
- **What**: Heuristic → Neural modeに切り替え
- **How**:
  1. `config.py`で`neural_mode=True`に設定
  2. 訓練済みモデル（ProjectionHead, ScoringHead）をロード
  3. RTX 5090でバッチ推論（MC Dropout + Conformal）
  4. ベンチマーク再評価：R@1 → 0.85+を目指す
- **Impact**: コード変更最小、精度向上最大（0.74→0.85で+15%）
- **工数**: 0.5日（設定変更+検証）

#### Task #30: 大規模埋め込みモデル導入（ViT-H-14）
- **What**: ViT-B-32（512-dim） → ViT-H-14（1024-dim）
- **How**:
  1. OpenCLIP ViT-H-14モデルをロード（RTX 5090で余裕）
  2. Qdrantスキーマを1024-dimに更新
  3. benchmark_v2動画を再インデックス
  4. ベンチマーク再評価：R@1 → 0.90+を目指す
- **Impact**: 判別力2倍（512→1024-dim）、業界標準達成
- **工数**: 1日（インデックス再構築+評価）

### Phase 2: 製造業特化（3-5日）— 顧客に見せられるデモ

#### Task #27: 業界特化機能実装
- **What**: 製造業SOP評価に必要な機能を追加
- **How**:
  1. **安全装備検出**: YOLOv8でヘルメット/手袋/保護メガネ検出
  2. **工具認識**: CLIP fine-tuning（レンチ、ドライバー、測定器）
  3. **産業用語彙**: 製造業用語辞書（torque wrench, oil pan, drain plug）
  4. **手順順序検証**: Soft-DTWで厳格なアライメントペナルティ
- **Impact**: 「うちの工場で使える」と思わせる
- **工数**: 3日（YOLOv8統合+CLIP fine-tune+評価）

#### Task #31: 製造業デモ動画生成
- **What**: リアルなオイル交換SOP動画（10ステップ）
- **How**:
  1. 実写素材またはCG生成（Blender + 工具3Dモデル）
  2. 正しい手順（Gold標準）と逸脱版（trainee）を作成
  3. 逸脱例：手順スキップ、工具間違い、安全装備なし
  4. SOPilotで検出→スコア差を証明
- **Impact**: 顧客デモに使える（「色パターン」では説得力ゼロ）
- **工数**: 2日（動画生成+検証）

### Phase 3: アルゴリズム強化（3-4日）— 精度の限界突破

#### Task #29: Re-ranking強化（MMR + Cross-encoder）
- **What**: 現在の軽量MMRを高精度版に置き換え
- **How**:
  1. **Cross-encoder re-scoring**: CLIPでtop-20を再スコアリング
  2. **Temporal coherence**: 連続クリップにボーナス（時系列整合性）
  3. **Hard negative mining**: 混同しやすいクリップ対で訓練
  4. **Alpha tuning**: Hybrid fusion weight最適化（grid search）
- **Impact**: R@5=1.00 → R@1=0.95+（最終精度の詰め）
- **工数**: 2日（実装+最適化）

#### Task #26: RTX 5090活用アーキテクチャ
- **What**: 32GB VRAMをフル活用してスループット最大化
- **How**:
  1. **バッチ並列化**: OpenCLIP + Qwen2.5-VL同時実行
  2. **CUDA最適化**: soft_dtw_cudaのカーネル高速化
  3. **ストリーミング推論**: 動画アップロード中に推論開始
  4. **Multi-GPU対応**: 将来的に複数GPUでスケール
- **Impact**: 評価時間「2時間→5分」が「2時間→30秒」に（10倍高速化）
- **工数**: 2日（並列化+プロファイリング）

### Phase 4: 実証（1-2日）— 顧客説得力

#### Task #32: ベンチマーク拡張（工業手順データセット）
- **What**: 製造業特化ベンチマーク（50+クエリ）
- **How**:
  1. 公開データセット（Assembly1M/COIN）から工業手順抽出
  2. Ground truth annotation（工具/安全装備/手順順序）
  3. 業界標準との比較（CLIP R@1=0.65程度、SOPilot→0.90+）
  4. 結果をグラフ化（顧客向け資料）
- **Impact**: 「既存手法より25%精度が高い」と証明
- **工数**: 1.5日（データ準備+評価）

#### Task #25: 現状分析と商用化ボトルネック特定 ✅ **このドキュメント**
- **What**: 改善計画の策定（完了）
- **Impact**: チーム方向性の統一

---

## 📈 成功指標（金を取れるレベル）

### 技術指標
- ✅ **R@1 ≥ 0.90**: 業界標準達成（現状0.74）
- ✅ **評価時間 ≤ 60秒**: 2時間の実技評価を1分に短縮（120倍高速化）
- ✅ **製造業ベンチマーク**: 既存手法（CLIP単体）より+20%精度向上
- ✅ **安全装備検出**: 95%以上の再現率（見逃しを最小化）

### ビジネス指標
- ✅ **デモ可能**: 製造業顧客に見せて「使える」と思わせる
- ✅ **ROI証明**: 評価コスト95%削減の試算提示
- ✅ **差別化**: 既存ソリューション（手動評価、汎用ML）との明確な優位性

---

## ⏱️ スケジュール（10-12日間）

### Week 1（7日）: 精度向上 + 製造業特化
| Day | タスク | 成果物 |
|-----|-------|--------|
| 1 | Task #28 Neural mode有効化 | R@1: 0.74→0.85 |
| 2 | Task #30 ViT-H-14導入 | R@1: 0.85→0.90 |
| 3-5 | Task #27 業界特化機能 | 安全装備/工具検出 |
| 6-7 | Task #31 製造業デモ動画 | オイル交換SOP動画 |

### Week 2（3-5日）: アルゴリズム強化 + 実証
| Day | タスク | 成果物 |
|-----|-------|--------|
| 8-9 | Task #29 Re-ranking強化 | R@1: 0.90→0.95 |
| 10-11 | Task #26 RTX 5090最適化 | 評価時間30秒達成 |
| 12 | Task #32 ベンチマーク拡張 | 製造業50+クエリ評価 |

---

## 🎯 優先順位判断基準

**最優先（Week 1開始）**:
1. Task #28 (Neural mode) — 最小工数で最大精度向上
2. Task #30 (ViT-H-14) — 業界標準R@1=0.90達成に必須
3. Task #31 (製造業デモ) — 顧客説得力に直結

**次点（Week 1後半）**:
4. Task #27 (業界特化) — デモ動画と組み合わせて効果発揮

**最後（Week 2）**:
5. Task #29/26/32 — 精度の最終調整と実証

---

## 🔧 実装開始：Task #28（Neural mode有効化）

**次の行動**:
1. `config.py`のneural_mode設定を確認
2. 訓練済みモデルの存在確認（models_dir）
3. RTX 5090でバッチ推論テスト
4. ベンチマーク再評価（real_v2.jsonl）

これを今から始めます。
